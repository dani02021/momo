<html>

<head>
    <style>
        table,
        th,
        td {
            border: 1px solid;
        }

        td {
            width: 30px;
            height: 30px;
            text-align: center;
        }
    </style>
</head>

<body>
    <input type="number" name="num" id="num">
    <textarea name="input" id="input" cols="30" rows="10" style="display: flex;"></textarea>
    <br>
    <button style="display: flex;" onclick="doAlg();">Squares</button>
    <br>
    <table id="table"></table>

    <script>
        var plane;
        var original;
        function doAlg() {
            let n = parseInt(document.getElementById("num").value);
            let text = document.getElementById("input").value;
            let textLines = text.split("\n");

            var objs = [];

            plane = new Array(n*n).fill(0).map(() => new Array(n*n).fill(0));
            original = new Array(n*n).fill(false).map(() => new Array(n*n).fill(false));

            for (i = 0; i < n * n; i++) {
                let obj = textLines[i];

                let objSplit = obj.split(" ");
                for (a = 0; a < n * n; a++) {
                    ch = objSplit[a].split('')[0];

                    if (ch != '0') {
                        if (!objs.includes(ch))
                            objs.push(ch);

                        original[a][i] = true;
                    }

                    plane[a][i] = ch;
                }
            }

            for (i = 0; i < plane.length; i++) {
                for (j = 0; j < plane[i].length; j++) {
                    iArr = 0;

                    if (plane[j][i] == '0') {
                        while (true) {
                            if (iArr == objs.length) {
                                while (true) {
                                    plane[j][i] = '0';

                                    locs = moveBack(j, i);

                                    if (original[locs[0]][locs[1]]) {
                                        while (true) {
                                            locs = moveBack(locs[0], locs[1]);

                                            if (!original[locs[0]][locs[1]])
                                                break;
                                        }
                                    }

                                    j = locs[0];
                                    i = locs[1];

                                    iArr = objs.indexOf(plane[j][i]) + 1;

                                    if (iArr != objs.length)
                                        break;
                                }
                            }

                            plane[j][i] = objs[iArr];

                            if (!hasViolation(j, i, n))
                                break;

                            iArr++;
                        }
                    }

                    // System.out.println("Values at arr["+j+"]["+i+"] is "+plane[j][i]);
                }
            }

            for(i=0; i<plane.length; i++) {
                let row = document.getElementById("table").insertRow();

                for(j=0; j<plane[i].length; j++) {
                    if (hasViolation(j, i, n) || plane[j][i] == '0') {
                        alert("Something went wrong!");
                    }
                    let cell = row.insertCell();
                    cell.innerHTML = plane[j][i];
                }
            }
        }

        function moveBack(j, i) {
            if (j == 0) {
                i--;
                j = plane[i].length - 1;
            } else j--;

            return [j, i];
        }

        function hasViolation(j, i, n) {
        ch = plane[j][i];

        if (ch == '0')
            return false;

        // Only element on the whole row
        for (j1 = 0; j1 < plane[i].length; j1++) {
            if (j == j1)
                continue;
            
            ch1 = plane[j1][i];

            if (ch == ch1)
                return true;
        }

        // Only element on the whole column
        for (i1 = 0; i1 < plane.length; i1++) {
            if (i == i1)
                continue;
            
            ch1 = plane[j][i1];

            if (ch == ch1)
                return true;
        }

        // Only element on the sub-block
        subblockrow = parseInt(i / n); // [0-1) is first row
        subblockcol = parseInt(j / n); // [0-1) is first col

        iEnd = subblockrow * n + (n - 1);
        jEnd = subblockcol * n + (n - 1);

        for(iBlock = subblockrow * n; iBlock <= iEnd; iBlock++) {
            for(jBlock = subblockcol * n; jBlock <= jEnd; jBlock++) {
                if (i == iBlock || j == jBlock)
                    continue;
                
                chBlock = plane[jBlock][iBlock];

                if (ch == chBlock)
                    return true;
                
                // System.out.println("Values at arr2["+jBlock+"]["+iBlock+"] is "+plane[jBlock][iBlock]);
            }
        }

        return false;
    }
    </script>
</body>

</html>